# 括弧
## ()
() パーレンはサブシェルでコマンドを実行します。

```bash
HOGE='1'
echo "サブシェル実行前: $HOGE"
#サブシェル実行前: 1
    
(echo "変更前: $HOGE"; HOGE='2'; echo "変更後: $HOGE")
#変更前: 1
#変更後: 2

echo "サブシェル実行後: $HOGE"
#サブシェル実行後: 1
```
   
サブシェルの実行は、カレントシェルの環境(シェル変数など)を引き継ぎます。カレントシェルにはサブシェル内のシェル変数の定義内容変更が影響しません。それが上のスクリプトで確認できます。

### サブシェル実行結果をリダイレクト

```bash
# サブシェルでの echo 結果を標準入力にリダイレクト
sort <(echo hoge; echo foo; echo bar;)
# bar
# foo
# hoge
```

## (( ))

二重丸括弧、double parenthesis、ダブルパーレン
(()) 二重丸括弧は単体の丸括弧 () と全く違う意味を持ち、(()) は for 文でC言語スタイルの条件を書くために使います。  
for や while と組み合わせるとC-Styleの条件で書けます。

```bash
# 以下for文の一例
for (( i=0; i<3; i++)); do echo $i; done
# 0
# 1
# 2
```
    
ワンライナーで書くならこのように for 文が書けます。  
スクリプトとして定義する場合には複数行でいい感じになります。  
```bash
my_script.sh
#!/bin/bash
# 2以上10以下の偶数を出力するfor文
for ((i=2; i<=10; i+=2)); do
    echo $i
    done
```
    
### そのほかの for 文との比較
シェルスクリプトで for in を使えば for (( と同じことができますが、幾つか方法があるので参考にまとめておきます。

```bash
for ((i=0; i<3; i++)); do echo $i; done
for i in {0..2}; do echo $i; done
for i in `seq 0 2`; do echo $i; done
for i in $(seq 0 2); do echo $i; done
for i in 0 1 2; do echo $i; done
#全部出力は 0, 1, 2 の3行です。
 ```   
単純な区間のループなら for i in {0..2} みたいな書き方のほうがわかりやすいし安全な気がするのですが、少し複雑な繰り返し条件を書くなら C-Style で書くのもよいですね。

### while 文の条件にも使える

while 文の条件式にも (()) 二重丸括弧が使えます。
```bash
while ((1==1)); do echo hello; sleep 1; done
#hello
#hello
#    .
#    .
# 上記コマンドでは、1秒ごとに echo が繰り返し実行されます。
```    

## \[　\] 角括弧、bracket、ブラケット
[　] ブラケットは test コマンドど等価のコマンドです。

test コマンドは if 文を書く時の条件式を書くときに使用されることが多いコマンドです。

```bash
# [] ブラケットで条件式を記述して判定できる
if [ 1 -eq 1 ]; then echo 'equal'; fi
#equal
    
# test と等価です。
if test 1 -eq 1; then echo 'equal'; fi
#equal
```   

test 1 -eq 1 で 1==1 の条件判定をしています。絶対に true なので 'equal' が出力されます。  
ブラケットを使用するメリットは if 文の条件式が見やすくなる点です。  
括弧の前後にはスペースを挿入しないと怒られます。\[ はコマンドの1つなのでスペースで区切ると覚えておきましょう。  

## [[　]] 
二重角括弧、double bracket

[[　]] は \[  \] ブラケットと同じような機能を持ちます。  
つまり test と等価ですが Bash でしか使えません。  
[[　]] は Bash で追加された組み込みのコマンドで [] の機能を拡張したコマンドになります。  

```bash
if [[ (1==1) && (1==2 || 3==1+2) ]]; then echo 'true'; fi
# true
```    
こんな感じで使います。[] だとうまく動きません。


\[\[ はBash の組み込みコマンドなので help \[\[ とすればヘルプが確認できます。


## $(　) 
ドル丸括弧、ドルパーレン

$() ドルパーレンは、カッコ内のコマンドを実行して実行結果を文字列として展開します。つまりバッククォートと同じ機能です。

```bash
# date コマンドの実行結果が文字列内に展開される
HOGE="today is $(date)"
    
# 結果確認
echo $HOGE
#today is Mon Mar 1 23:50:27 JST 2021
```    
バッククォートに置き換えても同じ結果になります。

### 入れ子にして実行
$() は入れ子にして実行することができます。  
例えばカレントディレクトリのディレクトリ名を取得するには以下のように入れ子の記述が可能です。  
バッククォートだと入れ子で記述できませんが、$() なら可能です。  


## $(()) 
$(()) ドル二重丸括弧、ドル二重パーレンは算術演算を実行し結果を展開します。
```bash
echo "1 + 2 = $((1 + 2))"
#1 + 2 = 3
```    
こんな感じで加減算などの算術演算を実行し、その結果を文字列内に展開してくれます。  
算術計算のを実行するためには expr コマンドで数式を評価することでも可能です。  
```bash
expr 1 + 2
#3
```
```bash
#echo "1 + 2 = $((1 + 2))" と等価
echo "1 + 2 = `expr 1 + 2`"
#1 + 2 = 3
```   

expr で実行した計算結果をバッククォートで埋め込めば $(()) と同じ機能が実現できます。  
$(()) のほうがわかりやすいですね。  

## ${　} 
ドル波括弧、ドルブレース

${} ドルブレースは、変数の埋め込みを行うときに使用します。  
例えば $HOGE で変数を文字列内に埋め込んだ時に、変数名の区切りがうまく処理できない場合には ${HOGE} のようにして使用すると埋め込みがうまくいきます。  
```bash
# 変数HOGE の直後に 'HOGE' と出力したい
HOGE="お金"
echo "${HOGE}ほしい"
# お金ほしい
```
